<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Pipeline</title>
        <link rel="stylesheet" href="common/base.css">
        <link rel="stylesheet" href="common/widget.css">

        <link rel="stylesheet" href="status.css">

        <link rel="stylesheet" href="widgets/failPhases.css">
        <link rel="stylesheet" href="widgets/averageJobRuntime.css">
        <link rel="stylesheet" href="widgets/jobRuntime.css">
        <link rel="stylesheet" href="widgets/averageTestRuntime.css">

        <style>
            section {
                width: 33.3%;
            }
        </style>
    </head>
    <body>
        <script src="node_modules/d3/d3.min.js"></script>

        <script src="status.js"></script>

        <script src="common/widget.js"></script>
        <script src="common/utils.js"></script>
        <script src="common/jobColors.js"></script>
        <script src="common/zoomableSunburst.js"></script>
        <script src="common/dataSource.js"></script>

        <script src="widgets/averageJobRuntime.js"></script>
        <script src="widgets/jobRuntime.js"></script>
        <script src="widgets/averageTestRuntime.js"></script>

        <script src="widgets/failedBuilds.js"></script>
        <script src="widgets/flakyBuilds.js"></script>
        <script src="widgets/failPhases.js"></script>
        <script src="widgets/testFailures.js"></script>

        <script>
            var findDataIdInAncestors = function (elem) {
                if (elem.attributes['data-id']) {
                    return elem.attributes['data-id'].value;
                } else if (elem.parentElement) {
                    return findDataIdInAncestors(elem.parentElement);
                }
            };

            var arrayOf = function (arrayLike) {
                return Array.prototype.slice.call(arrayLike);
            };

            var findDataIdTwins = function (dataId) {
                return arrayOf(document.querySelectorAll('g[data-id="' + CSS.escape(dataId) + '"]'));
            };

            d3.select('body')
              .on('mouseover', function (e) {
                  var dataId = findDataIdInAncestors(d3.event.target);
                  if (dataId) {
                      findDataIdTwins(dataId).forEach(function (twin) {
                          twin.classList.add('highlightedElement')
                      });
                  }
              })
              .on('mouseout', function () {
                  arrayOf(document.querySelectorAll('g.highlightedElement')).forEach(function (elem) {
                      elem.classList.remove('highlightedElement');
                  })
              });
        </script>
    </body>
</html>
